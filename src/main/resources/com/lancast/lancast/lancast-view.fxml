<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.Circle?>

<BorderPane fx:id="rootPane" xmlns="http://javafx.com/javafx/17"
   xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.lancast.lancast.LanCastController" 
   stylesheets="@styles.css">

   <!-- SIDEBAR -->
   <left>
      <VBox styleClass="sidebar" spacing="8" prefWidth="250">
         <HBox alignment="CENTER_LEFT" spacing="10">
            <Label text="â—ˆ" style="-fx-font-size: 26px; -fx-text-fill: -accent-color;"/>
            <Label text="LANCast" styleClass="sidebar-label" style="-fx-padding: 0;"/>
         </HBox>
         
         <Region prefHeight="20"/>

         <Button fx:id="homeBtn" text="  Dashboard" styleClass="nav-button" maxWidth="Infinity" onAction="#handleHome"/>
         <Button fx:id="historyBtn" text="  History" styleClass="nav-button" maxWidth="Infinity" onAction="#handleHistory"/>
         <Button fx:id="receiveBtn" text="  Inbox" styleClass="nav-button" maxWidth="Infinity" onAction="#handleReceive"/>
         <Button fx:id="settingsBtn" text="  Settings" styleClass="nav-button" maxWidth="Infinity" onAction="#handleSettings"/>

         <Region VBox.vgrow="ALWAYS"/>

         <VBox spacing="12" alignment="CENTER" style="-fx-background-color: -input-bg; -fx-background-radius: 12; -fx-padding: 18;">
            <Label text="SERVER" style="-fx-text-fill: -text-muted; -fx-font-size: 11px; -fx-font-weight: bold;"/>
            <Button fx:id="startBtn" text="â–¶  Start" styleClass="server-button-start" maxWidth="Infinity" onAction="#handleStart"/>
            <Label fx:id="versionLabel" text="v1.0.0 â€¢ Offline" styleClass="version-label"/>
         </VBox>
      </VBox>
   </left>

   <!-- CENTER -->
   <center>
      <ScrollPane fitToWidth="true" styleClass="scroll-pane">
         <StackPane fx:id="contentPane" style="-fx-background-color: -surface;">
            
            <!-- HOME VIEW -->
            <VBox fx:id="homeView" styleClass="center-pane" spacing="25">
               
               <!-- Header with Status + Peers -->
               <HBox alignment="CENTER_LEFT" spacing="15">
                  <VBox spacing="5">
                     <Label text="Dashboard" styleClass="header-label"/>
                     <Label text="Manage your file sharing" styleClass="subtitle-label"/>
                  </VBox>
                  <Region HBox.hgrow="ALWAYS"/>
                  
                  <!-- Connected Peers Badge -->
                  <HBox styleClass="card-small" alignment="CENTER" spacing="8" style="-fx-padding: 12 18;">
                     <Label text="ðŸ‘¥" style="-fx-font-size: 16px;"/>
                     <Label fx:id="peerCountLabel" text="0" style="-fx-font-weight: bold; -fx-font-size: 18px; -fx-text-fill: -accent-color;"/>
                     <Label text="Peers" style="-fx-font-size: 13px; -fx-text-fill: -text-muted;"/>
                  </HBox>
                  
                  <!-- Status Card with Offline + URL -->
                  <VBox styleClass="card-small" spacing="8" style="-fx-padding: 12 18;">
                     <HBox alignment="CENTER_LEFT" spacing="8">
                        <Circle fx:id="statusCircle" radius="5" fill="#ef4444"/>
                        <Label fx:id="serverStatusLabel" text="Offline" style="-fx-font-weight: bold; -fx-font-size: 13px; -fx-text-fill: -text-primary;"/>
                     </HBox>
                     <HBox alignment="CENTER" spacing="6">
                        <Label text="ðŸŒ" style="-fx-font-size: 12px;"/>
                        <Label fx:id="ipLabel" text="Not Connected" style="-fx-font-size: 11px; -fx-text-fill: -text-muted;"/>
                     </HBox>
                  </VBox>
               </HBox>

               <!-- MAIN ROW: Drop Zone + QR Code SIDE BY SIDE -->
               <HBox spacing="30" VBox.vgrow="ALWAYS">
                  
                  <!-- LEFT: Drop Zone + Files List -->
                  <VBox spacing="20" HBox.hgrow="ALWAYS">
                     
                     <!-- Share Files Title -->
                     <HBox alignment="CENTER_LEFT" spacing="8">
                        <Label text="Share Files" styleClass="section-title"/>
                        <Label text="ðŸ“¤" style="-fx-font-size: 14px;"/>
                     </HBox>
                     
                     <!-- Drop Zone -->
                     <StackPane fx:id="dropZone" styleClass="drop-zone" onMouseClicked="#handleBrowseFiles" VBox.vgrow="ALWAYS" minHeight="250">
                        <VBox alignment="CENTER" spacing="15">
                           <Label text="ðŸ“¤" style="-fx-font-size: 52px;"/>
                           <Label text="Drop files here or click to browse" styleClass="drop-zone-text"/>
                           <Button text="ðŸ“‚ Browse" styleClass="browse-button" onAction="#handleBrowseFiles"/>
                        </VBox>
                     </StackPane>

                     <!-- Files Section -->
                     <VBox spacing="12">
                        <HBox alignment="CENTER_LEFT" spacing="12">
                           <Label text="ðŸ“ Files" styleClass="section-title"/>
                           <Label fx:id="fileCountLabel" text="0" styleClass="count-badge"/>
                           <Label fx:id="statusLabel" text="Ready to share" style="-fx-font-size: 13px; -fx-text-fill: -text-muted;"/>
                           <Region HBox.hgrow="ALWAYS"/>
                           <Button fx:id="clearBtn" text="Clear" styleClass="clear-button" onAction="#handleClear"/>
                        </HBox>
                        
                        <ListView fx:id="fileListView" styleClass="file-list" prefHeight="180">
                           <placeholder>
                              <VBox alignment="CENTER" spacing="12">
                                 <Label text="ðŸ“‚" style="-fx-font-size: 42px; -fx-opacity: 0.2;"/>
                                 <Label text="No files added" style="-fx-text-fill: -text-muted; -fx-font-size: 14px;"/>
                              </VBox>
                           </placeholder>
                        </ListView>
                     </VBox>
                  </VBox>

                  <!-- RIGHT: QR Code Box (SAME ROW) -->
                  <VBox spacing="15" minWidth="380" maxWidth="400">
                     <HBox alignment="CENTER_LEFT" spacing="8">
                        <Label text="Quick Connect" styleClass="section-title"/>
                        <Label text="ðŸ”’" style="-fx-font-size: 14px;"/>
                     </HBox>
                     
                     <VBox styleClass="qr-container" spacing="20" alignment="CENTER" VBox.vgrow="ALWAYS">
                        <!-- QR Code -->
                        <StackPane style="-fx-background-color: white; -fx-padding: 18; -fx-background-radius: 14px;">
                           <Label fx:id="qrPlaceholderLabel" text="ðŸ“±" style="-fx-font-size: 140px; -fx-opacity: 0.12;"/>
                           <ImageView fx:id="qrCodeImageView" fitHeight="200" fitWidth="200" pickOnBounds="true" preserveRatio="true"/>
                        </StackPane>
                        
                        <Label text="Scan to connect" style="-fx-font-size: 14px; -fx-text-fill: -text-muted; -fx-font-weight: 600;"/>

                        <!-- URL - Click to copy -->
                        <VBox styleClass="pill" spacing="5" alignment="CENTER" style="-fx-min-width: 320px; -fx-cursor: hand;" onMouseClicked="#handleCopyUrl">
                           <Label text="URL (click to copy)" style="-fx-font-size: 11px; -fx-text-fill: -text-muted; -fx-font-weight: bold;"/>
                           <Label fx:id="urlLabel" text="http://0.0.0.0:8080" styleClass="pill-text"/>
                        </VBox>

                        <!-- PIN -->
                        <HBox spacing="12" alignment="CENTER">
                           <VBox styleClass="pill-pin" spacing="5" alignment="CENTER" style="-fx-min-width: 240px;" HBox.hgrow="ALWAYS">
                              <Label text="PIN" style="-fx-font-size: 11px; -fx-text-fill: -text-muted; -fx-font-weight: bold;"/>
                              <Label fx:id="pinLabel" text="1234" style="-fx-font-size: 32px; -fx-font-weight: bold; -fx-text-fill: -accent-color; -fx-font-family: 'Consolas', monospace;"/>
                           </VBox>
                           <Button text="â†»" styleClass="refresh-button" onAction="#handleRefreshPin"/>
                        </HBox>
                     </VBox>
                  </VBox>
               </HBox>
            </VBox>

            <!-- HISTORY VIEW -->
            <VBox fx:id="historyView" styleClass="center-pane" spacing="20" visible="false">
               <VBox spacing="5">
                  <Label text="History" styleClass="header-label"/>
                  <Label text="Past file transfers" styleClass="subtitle-label"/>
               </VBox>
               <TableView fx:id="historyTable" VBox.vgrow="ALWAYS" styleClass="table-view">
                  <columns>
                     <TableColumn fx:id="timeCol" text="Time" prefWidth="160"/>
                     <TableColumn fx:id="deviceCol" text="Device" prefWidth="140"/>
                     <TableColumn fx:id="fileCol" text="File" prefWidth="320"/>
                     <TableColumn fx:id="ipCol" text="IP Address" prefWidth="140"/>
                  </columns>
               </TableView>
            </VBox>

            <!-- RECEIVE VIEW -->
            <VBox fx:id="receiveView" styleClass="center-pane" spacing="20" visible="false">
               <HBox alignment="CENTER_LEFT" spacing="15">
                  <VBox spacing="5">
                     <Label text="Inbox" styleClass="header-label"/>
                     <Label text="Received files" styleClass="subtitle-label"/>
                  </VBox>
                  <Region HBox.hgrow="ALWAYS"/>
                  <Button text="â†»" styleClass="refresh-button" onAction="#handleRefreshReceived"/>
                  <Label fx:id="receivedCountLabel" text="0 files" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: -text-secondary;"/>
               </HBox>
               <VBox styleClass="card-small" VBox.vgrow="ALWAYS" style="-fx-padding: 0;">
                  <ListView fx:id="receivedFilesListView" styleClass="file-list" VBox.vgrow="ALWAYS"/>
               </VBox>
               <Button text="ðŸ“‚ Open Folder" styleClass="action-button" onAction="#handleOpenUploadsFolder"/>
            </VBox>

            <!-- SETTINGS VIEW -->
            <VBox fx:id="settingsView" styleClass="center-pane" spacing="25" visible="false">
               <VBox spacing="5">
                  <Label text="Settings" styleClass="header-label"/>
                  <Label text="Customize LanCast" styleClass="subtitle-label"/>
               </VBox>
               
               <!-- Appearance -->
               <VBox styleClass="settings-section" spacing="18" style="-fx-max-width: 450px;">
                  <Label text="ðŸŽ¨ Appearance" styleClass="settings-title"/>
                  
                  <HBox alignment="CENTER_LEFT" spacing="15">
                     <VBox spacing="4" HBox.hgrow="ALWAYS">
                        <Label text="Mode" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: -text-primary;"/>
                        <Label text="Dark or Light theme" styleClass="settings-description"/>
                     </VBox>
                     <Button fx:id="modeToggleBtn" text="ðŸŒ™" styleClass="mode-toggle" onAction="#handleModeToggle"/>
                  </HBox>
                  
                  <VBox spacing="10">
                     <Label text="Accent Color" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: -text-primary;"/>
                     <HBox spacing="14" alignment="CENTER_LEFT">
                        <Button fx:id="accentPurpleBtn" styleClass="accent-button, accent-purple-btn" onAction="#handleAccentPurple"/>
                        <Button fx:id="accentBlueBtn" styleClass="accent-button, accent-blue-btn" onAction="#handleAccentBlue"/>
                        <Button fx:id="accentPinkBtn" styleClass="accent-button, accent-pink-btn" onAction="#handleAccentPink"/>
                        <Button fx:id="accentGreenBtn" styleClass="accent-button, accent-green-btn" onAction="#handleAccentGreen"/>
                        <Button fx:id="accentOrangeBtn" styleClass="accent-button, accent-orange-btn" onAction="#handleAccentOrange"/>
                     </HBox>
                  </VBox>
               </VBox>
               
               <!-- Security -->
               <VBox styleClass="settings-section" spacing="15" style="-fx-max-width: 450px;">
                  <Label text="ðŸ” Security" styleClass="settings-title"/>
                  <HBox alignment="CENTER_LEFT" spacing="15">
                     <VBox spacing="4" HBox.hgrow="ALWAYS">
                        <Label text="PIN Code" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: -text-primary;"/>
                        <Label text="Required for connections" styleClass="settings-description"/>
                     </VBox>
                     <Label fx:id="settingsPinLabel" text="1234" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-font-family: 'Consolas', monospace; -fx-text-fill: -text-primary;"/>
                     <Button text="â†»" styleClass="refresh-button" onAction="#handleRefreshPin"/>
                  </HBox>
               </VBox>
               
               <!-- About -->
               <VBox styleClass="settings-section" spacing="10" style="-fx-max-width: 450px;">
                  <Label text="â„¹ï¸ About" styleClass="settings-title"/>
                  <Label text="LanCast v1.0.0" style="-fx-font-weight: bold; -fx-font-size: 14px; -fx-text-fill: -text-primary;"/>
                  <Label text="Simple and secure LAN file sharing" styleClass="settings-description"/>
               </VBox>
            </VBox>

         </StackPane>
      </ScrollPane>
   </center>

</BorderPane>
